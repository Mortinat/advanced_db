import matplotlib.pyplot as plt
import numpy as np

psql_write = {'1000_1': 0.016562819480895996, '1000_5': 0.022902766863505047, '1000_10': 0.03804957866668701, '10000_1': 0.15517079830169678, '10000_5': 0.11019376913706462, '10000_10': 0.10975054899851482, '100000_1': 1.0492417414983113, '100000_5': 1.3564972480138142, '100000_10': 0.9196525812149048, '1000000_1': 15.51716391245524, '1000000_5': 14.246598839759827, '1000000_10': 16.782450040181477}
psql_read =  {'1000_1': 0.00282899538675944, '1000_5': 0.002919157346089681, '1000_10': 0.0061263640721638995, '10000_1': 0.008414665857950846, '10000_5': 0.007598479588826497, '10000_10': 0.007721225420633952, '100000_1': 0.06917726993560791, '100000_5': 0.06677226225535075, '100000_10': 0.044088403383890785, '1000000_1': 0.5007156928380331, '1000000_5': 0.5331814686457316, '1000000_10': 0.8093306620915731}
kafka_write = {'1000_1': 0.40510789553324383, '10000_1': 0.4876928726832072, '100000_1': 1.0567858616511028, '1000000_1': 6.777573744455974, '1000_5': 0.9691217343012491, '10000_5': 1.0545655886332195, '100000_5': 1.4118385712305705, '1000000_5': 8.048855622609457, '1000_10': 1.6202346086502075, '10000_10': 1.6324197053909302, '100000_10': 1.8318881591161091, '1000000_10': 8.502586960792542}
kafka_read = {'1000_1': 0.11567211151123047, '10000_1': 0.1302271286646525, '100000_1': 0.2245957056681315, '1000000_1': 1.2065948645273845, '1000_5': 0.5742926597595215, '10000_5': 0.5872522592544556, '100000_5': 0.6492248773574829, '1000000_5': 1.2406264146169026, '1000_10': 1.1474403540293376, '10000_10': 1.1723965009053547, '100000_10': 1.2555427551269531, '1000000_10': 1.4375127951304119}
eventstore_read = {'1000_1': 0.00154419740041097, '1000_5': 0.0037831862767537436, '1000_10': 0.007036050160725911, '10000_1': 0.0015991528828938801, '10000_5': 0.0036472479502360025, '10000_10': 0.00661619504292806, '100000_1': 0.0014345248540242512, '100000_5': 0.004029075304667155, '100000_10': 0.006031115849812825, '1000000_1': 0.0015598138173421223, '1000000_5': 0.004068692525227864, '1000000_10': 0.006051341692606608}
eventstore_write = {'1000_1': 0.05208452542622884, '1000_5': 0.02164284388224284, '1000_10': 0.03150169054667155, '10000_1': 0.3530960480372111, '10000_5': 0.1675333579381307, '10000_10': 0.14880271752675375, '100000_1': 1.454340895016988, '100000_5': 1.5993284781773884, '100000_10': 2.3901769320170083, '1000000_1': 12.207570552825928, '1000000_5': 11.30185580253601, '1000000_10': 12.094262997309366}
NUM_ROWS = [1000, 10000, 100000, 1000000]
NUM_THREADS = [1, 5, 10]

x = np.arange(len(NUM_THREADS))  # the label locations
width = 0.25  # the width of the bars
multiplier = 0

for num_row in NUM_ROWS:
    fig, ax = plt.subplots(layout='constrained')
    psql_list = []
    eventstore_list = []
    kafka_list = []
    for num_thread in NUM_THREADS:
        psql_list.append(psql_read.get(f"{num_row}_{num_thread}", 0))
        eventstore_list.append(eventstore_read.get(f"{num_row}_{num_thread}", 0))
        kafka_list.append(kafka_read.get(f"{num_row}_{num_thread}", 0))
    rects = ax.bar(x + width * 0, psql_list, width, label=f"psql")
    ax.bar_label(rects, padding=3)
    rects = ax.bar(x + width * 1, eventstore_list, width, label=f"eventstore")
    ax.bar_label(rects, padding=3)
    rects = ax.bar(x + width * 2, kafka_list, width, label=f"kafka")
    ax.bar_label(rects, padding=3)

    ax.set_ylabel('time in seconds')
    ax.set_title(f'Read time comparison for {num_row} rows by number of threads')
    ax.set_xticks(x + width, NUM_THREADS)
    ax.legend(loc='upper left', ncols=3)
    plt.savefig(f'read_{num_row}.png')